<%# Locals: current_user (User) %>
<%= helpers.turbo_stream_from notifications_stream_key %>

<div id="<%= dom_id(current_user, :navbar_notifications) %>" class="dropdown dropdown-end">
  <label tabindex="0" class="btn btn-ghost btn-circle">
    <div class="indicator">
      <%= icon "bell", class: "h-5 w-5" %>
      <% if unread? %>
        <span class="badge badge-xs badge-primary indicator-item"></span>
      <% end %>
    </div>
  </label>
  <div tabindex="0" class="mt-3 z-[1] card card-compact dropdown-content w-72 sm:w-96 bg-base-100 shadow">
    <div class="card-body p-0">
      <div class="flex justify-between items-center p-3 border-b border-base-300">
        <h3 class="card-title text-base">Notifications</h3>
        <% if unread? %>
          <%= button_to "Mark all as read", mark_all_as_read_notifications_path, method: :patch, class: "link link-hover text-xs", form_class: "inline" %>
        <% end %>
      </div>

      <div id="<%= dom_id(current_user, :navbar_notifications_list) %>" class="max-h-96 overflow-y-auto divide-y divide-base-300">
        <% if notifications.any? %>
          <%= render partial: "notifications/notification", collection: notifications, as: :notification %>
        <% else %>
          <p class="p-4 text-center text-sm text-opacity-70">No new notifications.</p>
        <% end %>
      </div>

      <div class="card-actions p-3 border-t border-base-300">
        <%= link_to "View all notifications", notifications_path, class: "btn btn-primary btn-block btn-sm" %>
      </div>
    </div>
  </div>
</div>
